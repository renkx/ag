# 什么时候必须加 reuseport？只有在你的最外层入口（即直接暴露给公网的端口）建议加上，内部回环（Loopback）不需要加，加了反而有CPU消耗
# TCP (HTTPS/1.1 & H2)
server {
    listen 443 reuseport so_keepalive=on;
    listen [::]:443 reuseport so_keepalive=on;
    listen 443 udp reuseport;
    listen [::]:443 udp reuseport;

    proxy_pass $backend_name_443;

    # 【全局开启】把真 IP 传给所有人！
    # 即使 FRP 不支持，我们也先发出去，由下一步的清洗层处理
    proxy_protocol on;

    # 开启预读ssl功能 $ssl_preread_server_name
    ssl_preread on;
    # 这里放一个通用的、较宽松的配置（外部转发配置）
    include /common/stream/server/proxy_external.conf;
}
